<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>글로벌 마켓 주도섹터 분석기 (실제 데이터)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { background-color: #050505; color: #f1f5f9; font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, sans-serif; }
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        .glass { background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(16px); border: 1px solid rgba(255,255,255,0.05); }
        .stock-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 0.5rem; }
        .leader-gradient { background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%); }
        .animate-pulse-subtle { animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .7; } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback } = React;
        const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, ReferenceLine } = Recharts;

        const Icon = ({ name, size = 18, className = "" }) => {
            const icons = {
                TrendingUp: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></svg>,
                RefreshCw: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M8 21H3v-5"></path></svg>,
                Zap: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>,
                Trophy: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path><path d="M4 22h16"></path><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"></path><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"></path><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"></path></svg>,
                Settings: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33-1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>,
                Info: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>,
                ExternalLink: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>
            };
            return icons[name] || null;
        };

        const generateColor = (idx) => {
            const hues = [210, 0, 145, 200, 25, 280, 330, 45, 175, 10, 250, 80, 20, 300, 120, 190];
            return `hsl(${hues[idx % hues.length]}, 70%, 60%)`;
        };

        // Polygon용 티커 매핑 (Free 티어 호환 및 데이터 정확성 확보용)
        const MAP_TICKER = (t) => {
            const map = {
                "DJI": "DIA",      
                "DJTA": "IYT",     // Dow Jones Transportation Average -> iShares Transportation ETF (IYT)로 매핑
                "NIKKEI": "EWJ",   
                "KOSPI": "EWY",    
                "HSI": "FXI",      
                "GOLD": "GLD",     
                "SILVER": "SLV",   
                "COPPER": "CPER",  
                "CL1!": "USO",     
                "NG1!": "UNG",     
                "US02Y": "SHY",    
                "US10Y": "IEF",    
                "DXY": "UUP",      
                "BTCUSDT": "X:BTCUSD",
                "ETHUSDT": "X:ETHUSD"
            };
            return map[t] || t;
        };

        const CATEGORIZED_LIST = [
            { category: "주요 지수 및 테마", items: [{ ticker: "DJI", name: "다우존스" }, { ticker: "SPY", name: "S&P 500" }, { ticker: "QQQ", name: "나스닥 100" }, { ticker: "IWM", name: "러셀 2000" }, { ticker: "ARKK", name: "아크 혁신" }, { ticker: "MAGS", name: "M7 ETF" }] },
            { category: "섹터별 ETF", items: [{ ticker: "XLI", name: "산업재" }, { ticker: "XLV", name: "헬스케어" }, { ticker: "XLK", name: "기술주" }, { ticker: "XLY", name: "임의소비재" }, { ticker: "XLC", name: "커뮤니케이션" }, { ticker: "XLP", name: "필수소비재" }, { ticker: "XLF", name: "금융" }, { ticker: "XLB", name: "소재" }, { ticker: "XLE", name: "에너지" }, { ticker: "XLU", name: "유틸리티" }, { ticker: "XLRE", name: "부동산" }] },
            { category: "기술 및 소프트웨어", items: [{ ticker: "IGV", name: "소프트웨어" }, { ticker: "SKYY", name: "클라우드" }, { ticker: "CIBR", name: "사이버 보안" }, { ticker: "SMH", name: "반도체" }] },
            { category: "실물 경기 및 운송", items: [{ ticker: "XHB", name: "주택 건설" }, { ticker: "BDRY", name: "해운 운임" }, { ticker: "AWAY", name: "여행 테크" }, { ticker: "BOAT", name: "글로벌 해운" }, { ticker: "DJTA", name: "다우 운송" }, { ticker: "IYT", name: "미국 운송" }, { ticker: "XRT", name: "소매 리테일" }] },
            { category: "바이오 및 방산/우주", items: [{ ticker: "XBI", name: "생명공학" }, { ticker: "ITA", name: "항공우주/방위" }, { ticker: "SHLD", name: "방위 테크" }, { ticker: "UFO", name: "우주 산업" }, { ticker: "JETS", name: "글로벌 항공" }, { ticker: "DRNZ", name: "드론 테크" }] },
            { category: "친환경 및 모빌리티", items: [{ ticker: "WGMI", name: "비트코인 채굴" }, { ticker: "GRID", name: "스마트 그리드" }, { ticker: "LIT", name: "리튬/배터리" }, { ticker: "TAN", name: "태양광" }, { ticker: "PAVE", name: "미국 인프라" }, { ticker: "ICLN", name: "클린 에너지" }, { ticker: "URA", name: "우라늄/원자력" }, { ticker: "HYDR", name: "수소 에너지" }, { ticker: "DRIV", name: "자율주행/EV" }, { ticker: "FAN", name: "풍력 에너지" }] },
            { category: "채권, 달러 및 아시아", items: [{ ticker: "DXY", name: "달러 인덱스" }, { ticker: "US02Y", name: "미 2년물" }, { ticker: "US10Y", name: "미 10년물" }, { ticker: "NIKKEI", name: "니케이 225" }, { ticker: "HSI", name: "항셍 지수" }, { ticker: "KOSPI", name: "코스피" }] },
            { category: "원자재 및 선물", items: [{ ticker: "GOLD", name: "금" }, { ticker: "GDX", name: "금광 기업" }, { ticker: "SIL", name: "은광 기업" }, { ticker: "COPX", name: "구리 광산" }, { ticker: "SILVER", name: "은" }, { ticker: "COPPER", name: "구리" }, { ticker: "NG1!", name: "천연가스" }, { ticker: "CL1!", name: "WTI 유가" }] },
            { category: "가상자산", items: [{ ticker: "ETHUSDT", name: "이더리움" }, { ticker: "BTCUSDT", name: "비트코인" }] }
        ];

        const ALL_ITEMS = [];
        CATEGORIZED_LIST.forEach((cat) => {
            cat.items.forEach((item) => {
                ALL_ITEMS.push({ ...item, category: cat.category, color: generateColor(ALL_ITEMS.length) });
            });
        });

        const App = () => {
            const [timeframe, setTimeframe] = useState(30); 
            const [visibleStocks, setVisibleStocks] = useState(new Set(["SPY", "SMH", "BTCUSDT", "XLK", "MAGS", "DJTA"]));
            const [stockDataMap, setStockDataMap] = useState({}); 
            const [isFetching, setIsFetching] = useState(false);
            const [apiKey, setApiKey] = useState(localStorage.getItem('polygon_api_key') || '');
            const [showSettings, setShowSettings] = useState(!localStorage.getItem('polygon_api_key'));
            const [statusMsg, setStatusMsg] = useState('');

            const fetchTickerData = async (ticker, key) => {
                const mapped = MAP_TICKER(ticker);
                const to = new Date().toISOString().split('T')[0];
                const fromDate = new Date();
                fromDate.setDate(fromDate.getDate() - 450);
                const from = fromDate.toISOString().split('T')[0];
                const url = `https://api.polygon.io/v2/aggs/ticker/${mapped}/range/1/day/${from}/${to}?adjusted=true&sort=asc&limit=5000&apiKey=${key}`;
                const res = await fetch(url);
                if (res.status === 429) throw new Error("RATE_LIMIT");
                const data = await res.json();
                if (!data.results) return null;
                const prices = {};
                data.results.forEach(day => {
                    const d = new Date(day.t).toISOString().split('T')[0];
                    prices[d] = day.c;
                });
                return prices;
            };

            const handleFetchAllVisible = useCallback(async () => {
                if (!apiKey) {
                    setStatusMsg("API 키를 먼저 입력해주세요.");
                    setShowSettings(true);
                    return;
                }
                setIsFetching(true);
                setStatusMsg("데이터 동기화 시작...");
                const targetTickers = Array.from(new Set(["QQQ", ...Array.from(visibleStocks)]));
                const newMap = { ...stockDataMap };
                try {
                    for (let i = 0; i < targetTickers.length; i++) {
                        const t = targetTickers[i];
                        if (newMap[t]) continue;
                        if (i > 0 && i % 5 === 0) {
                            for (let sec = 60; sec > 0; sec--) {
                                setStatusMsg(`Polygon 제한 대기 중... ${sec}초 (${i}/${targetTickers.length})`);
                                await new Promise(r => setTimeout(r, 1000));
                            }
                        }
                        setStatusMsg(`${t} 데이터를 분석 중...`);
                        try {
                            const data = await fetchTickerData(t, apiKey);
                            if (data) newMap[t] = data;
                        } catch (err) {
                            if (err.message === "RATE_LIMIT") {
                                setStatusMsg("호출 속도 제한 발생. 60초간 일시정지합니다.");
                                await new Promise(r => setTimeout(r, 62000));
                                i--;
                            }
                        }
                    }
                    setStockDataMap(newMap);
                    setStatusMsg("데이터 동기화 완료");
                    setTimeout(() => setStatusMsg(""), 3000);
                } catch (e) {
                    setStatusMsg("오류 발생: " + e.message);
                } finally {
                    setIsFetching(false);
                }
            }, [apiKey, visibleStocks, stockDataMap]);

            const commonDates = useMemo(() => {
                if (!stockDataMap["QQQ"]) return [];
                const qqqDates = Object.keys(stockDataMap["QQQ"]).sort();
                return qqqDates.slice(-timeframe);
            }, [stockDataMap, timeframe]);

            const chartData = useMemo(() => {
                if (commonDates.length === 0) return [];
                const startDate = commonDates[0];
                const startQQQ = stockDataMap["QQQ"][startDate];
                return commonDates.map(date => {
                    const point = { date };
                    const qqqRet = stockDataMap["QQQ"][date] / startQQQ;
                    visibleStocks.forEach(t => {
                        if (stockDataMap[t] && stockDataMap[t][date]) {
                            const startPrice = stockDataMap[t][startDate] || Object.values(stockDataMap[t])[0];
                            const stockRet = stockDataMap[t][date] / startPrice;
                            point[t] = parseFloat(((stockRet / qqqRet - 1) * 100).toFixed(2));
                        }
                    });
                    return point;
                });
            }, [commonDates, stockDataMap, visibleStocks]);

            const ranking = useMemo(() => {
                if (commonDates.length < 2) return [];
                const start = commonDates[0];
                const end = commonDates[commonDates.length - 1];
                const qqqRet = stockDataMap["QQQ"][end] / stockDataMap["QQQ"][start];
                return ALL_ITEMS.map(s => {
                    if (!stockDataMap[s.ticker] || !stockDataMap[s.ticker][start] || !stockDataMap[s.ticker][end]) return null;
                    const stockRet = stockDataMap[s.ticker][end] / stockDataMap[s.ticker][start];
                    return { ticker: s.ticker, name: s.name, rs: ((stockRet / qqqRet - 1) * 100).toFixed(2), color: s.color };
                }).filter(i => i !== null).sort((a, b) => b.rs - a.rs);
            }, [commonDates, stockDataMap]);

            const saveKey = (val) => {
                setApiKey(val);
                localStorage.setItem('polygon_api_key', val);
            };

            const toggleVisible = (ticker) => {
                const next = new Set(visibleStocks);
                next.has(ticker) ? next.delete(ticker) : next.add(ticker);
                setVisibleStocks(next);
            };

            return (
                <div className="min-h-screen p-4 md:p-8">
                    <div className="max-w-7xl mx-auto space-y-6">
                        
                        {/* Header */}
                        <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 glass p-6 rounded-3xl relative overflow-hidden">
                            <div className="flex items-center gap-4 relative z-10">
                                <div className="p-3 leader-gradient rounded-2xl shadow-lg shadow-indigo-500/20">
                                    <Icon name="Zap" className="text-white" size={24} />
                                </div>
                                <div>
                                    <h1 className="text-xl font-black text-white italic tracking-tighter uppercase">Market Leader (Live)</h1>
                                    <div className="flex gap-2 mt-1">
                                        <span className="text-[9px] font-bold text-slate-500 uppercase tracking-widest border border-slate-800 px-2 rounded">Polygon.io Integrated</span>
                                        {statusMsg && <span className="text-[9px] font-bold text-indigo-400 uppercase animate-pulse">{statusMsg}</span>}
                                    </div>
                                </div>
                            </div>
                            
                            <div className="flex flex-wrap items-center gap-2 relative z-10">
                                <div className="flex gap-1 bg-black/40 p-1 rounded-2xl border border-white/5">
                                    {[7, 30, 90, 180].map(d => (
                                        <button key={d} onClick={() => setTimeframe(d)} className={`px-4 py-2 rounded-xl text-[10px] font-black transition-all ${timeframe === d ? 'bg-indigo-600 text-white shadow-lg' : 'text-slate-500 hover:text-white'}`}>
                                            {d === 7 ? '1W' : d === 30 ? '1M' : d === 90 ? '3M' : '6M'}
                                        </button>
                                    ))}
                                </div>
                                <button onClick={() => setShowSettings(!showSettings)} className="p-2.5 bg-slate-900 border border-slate-800 text-slate-400 rounded-xl hover:text-white transition-all">
                                    <Icon name="Settings" size={16} />
                                </button>
                                <button 
                                    onClick={handleFetchAllVisible} 
                                    disabled={isFetching}
                                    className="px-5 py-2.5 bg-white text-black rounded-xl font-black text-xs hover:bg-indigo-50 transition-all flex items-center gap-2 disabled:opacity-50"
                                >
                                    <Icon name="RefreshCw" className={isFetching ? "animate-spin" : ""} size={14} /> 
                                    {isFetching ? 'Syncing...' : '데이터 실시간 갱신'}
                                </button>
                            </div>
                        </div>

                        {/* Settings Panel */}
                        {showSettings && (
                            <div className="glass p-6 rounded-3xl border border-indigo-500/30 animate-in fade-in slide-in-from-top-4">
                                <div className="flex justify-between items-center mb-6">
                                    <h3 className="text-sm font-black text-white flex items-center gap-2 uppercase tracking-widest">
                                        <Icon name="Settings" size={16} className="text-indigo-400" /> API CONFIGURATION
                                    </h3>
                                    <a 
                                        href="https://polygon.io/dashboard/signup" 
                                        target="_blank" 
                                        rel="noopener noreferrer"
                                        className="text-[10px] font-bold text-indigo-400 hover:text-white transition-colors flex items-center gap-1 bg-indigo-500/10 px-3 py-1.5 rounded-lg border border-indigo-500/20"
                                    >
                                        Polygon.io API 키 무료 발급받기 <Icon name="ExternalLink" size={12} />
                                    </a>
                                </div>
                                <div className="space-y-4">
                                    <div>
                                        <label className="text-[10px] font-bold text-slate-500 uppercase mb-2 block tracking-widest">Polygon.io API Key</label>
                                        <div className="flex gap-2">
                                            <input 
                                                type="password" 
                                                value={apiKey} 
                                                onChange={(e) => saveKey(e.target.value)}
                                                placeholder="API 키를 입력하세요" 
                                                className="flex-1 bg-black border border-slate-800 rounded-xl px-4 py-2.5 text-sm outline-none focus:border-indigo-500"
                                            />
                                            <button onClick={() => setShowSettings(false)} className="px-6 py-2 bg-indigo-600 text-white rounded-xl text-xs font-bold shadow-lg shadow-indigo-600/20">저장 및 닫기</button>
                                        </div>
                                    </div>
                                    <div className="flex items-start gap-2 p-3 bg-indigo-500/10 rounded-xl border border-indigo-500/20">
                                        <Icon name="Info" size={14} className="text-indigo-400 mt-0.5" />
                                        <p className="text-[10px] text-indigo-300 leading-relaxed font-medium">
                                            무료 API 키는 1분당 5회 호출 제한이 있습니다. <br/>
                                            다우 운송 티커(DJTA)는 트럼프 미디어(DJT)와 혼동되지 않도록 실시간 ETF 데이터인 <strong>IYT</strong>로 매핑하여 분석합니다.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        )}

                        <div className="grid grid-cols-1 lg:grid-cols-4 gap-6">
                            
                            {/* Ranking Card */}
                            <div className="lg:col-span-1 glass p-6 rounded-3xl flex flex-col space-y-4 max-h-[600px]">
                                <div className="flex items-center justify-between">
                                    <h2 className="text-xs font-black text-slate-400 uppercase tracking-widest flex items-center gap-2">
                                        <Icon name="Trophy" size={14} className="text-yellow-500" /> RS LEADERBOARD
                                    </h2>
                                    <span className="text-[9px] bg-yellow-500/10 text-yellow-500 px-1.5 rounded font-bold uppercase tracking-tighter">vs QQQ</span>
                                </div>
                                <div className="flex-1 space-y-2 overflow-y-auto pr-2 custom-scroll">
                                    {ranking.length > 0 ? (
                                        ranking.slice(0, 15).map((item, idx) => (
                                            <div key={item.ticker} onClick={() => toggleVisible(item.ticker)} className="group flex items-center justify-between p-3 rounded-2xl bg-white/5 border border-white/5 hover:border-indigo-500/50 cursor-pointer transition-all">
                                                <div className="flex items-center gap-3">
                                                    <span className={`text-[10px] font-black ${idx < 3 ? 'text-yellow-500' : 'text-slate-600'}`}>{idx + 1}</span>
                                                    <div>
                                                        <div className="text-sm font-black text-white group-hover:text-indigo-400">{item.ticker}</div>
                                                        <div className="text-[9px] text-slate-500 font-bold truncate w-20">{item.name}</div>
                                                    </div>
                                                </div>
                                                <div className="text-right">
                                                    <div className={`text-xs font-black ${parseFloat(item.rs) >= 0 ? 'text-indigo-400' : 'text-rose-400'}`}>
                                                        {parseFloat(item.rs) > 0 ? '+' : ''}{item.rs}%
                                                    </div>
                                                    <div className="w-12 h-1 bg-slate-800 rounded-full mt-1 overflow-hidden">
                                                        <div className="h-full" style={{ width: `${Math.min(Math.abs(item.rs) * 3, 100)}%`, backgroundColor: item.color }}></div>
                                                    </div>
                                                </div>
                                            </div>
                                        ))
                                    ) : (
                                        <div className="h-full flex flex-col items-center justify-center text-center space-y-2 opacity-30">
                                            <Icon name="RefreshCw" size={32} />
                                            <p className="text-[10px] font-bold">데이터를 갱신하면<br/>순위가 표시됩니다</p>
                                        </div>
                                    )}
                                </div>
                                <p className="text-[9px] text-slate-600 font-medium italic text-center leading-tight tracking-tight">
                                    선택한 기간 동안 QQQ 대비 초과 수익률(RS)을<br/> 실시간으로 계산하여 순위를 매깁니다.
                                </p>
                            </div>

                            {/* Main Chart */}
                            <div className="lg:col-span-3 glass p-6 md:p-8 rounded-[2.5rem] relative min-h-[500px]">
                                <div className="flex justify-between items-center mb-8">
                                    <div className="flex items-center gap-3">
                                        <div className="w-2 h-2 rounded-full bg-indigo-500 animate-pulse-subtle"></div>
                                        <h2 className="text-xs font-black text-slate-400 uppercase tracking-[0.2em]">Relative Strength Trend</h2>
                                    </div>
                                    <div className="hidden md:flex items-center gap-4 text-[9px] font-black text-slate-600 italic">
                                        ZERO LINE = QQQ BENCHMARK PERFORMANCE
                                    </div>
                                </div>
                                
                                <div className="h-[400px] w-full">
                                    {chartData.length > 0 ? (
                                        <ResponsiveContainer width="100%" height="100%">
                                            <LineChart data={chartData} margin={{ top: 0, right: 10, left: -20, bottom: 0 }}>
                                                <CartesianGrid strokeDasharray="3 3" stroke="#1e293b" vertical={false} />
                                                <XAxis dataKey="date" stroke="#475569" tick={{fontSize: 9, fontWeight: 700}} tickFormatter={val => val.slice(5)} minTickGap={40} axisLine={false} tickLine={false} />
                                                <YAxis stroke="#475569" tick={{fontSize: 9, fontWeight: 700}} unit="%" domain={['auto', 'auto']} axisLine={false} tickLine={false} />
                                                <Tooltip contentStyle={{ backgroundColor: '#000', border: '1px solid #334155', borderRadius: '12px', fontSize: '10px' }} />
                                                <Legend verticalAlign="top" height={36} iconType="circle" />
                                                <ReferenceLine y={0} stroke="#f43f5e" strokeDasharray="6 6" strokeWidth={1} />
                                                {Array.from(visibleStocks).map((t, idx) => {
                                                    const color = ALL_ITEMS.find(i => i.ticker === t)?.color || generateColor(idx);
                                                    return stockDataMap[t] && (
                                                        <Line key={t} type="monotone" dataKey={t} name={t} stroke={color} strokeWidth={3} dot={false} activeDot={{ r: 5 }} connectNulls animationDuration={500} />
                                                    );
                                                })}
                                            </LineChart>
                                        </ResponsiveContainer>
                                    ) : (
                                        <div className="h-full flex flex-col items-center justify-center space-y-4">
                                            <div className="p-4 bg-indigo-500/5 rounded-full border border-indigo-500/10 text-indigo-500">
                                                <Icon name="TrendingUp" size={48} className="opacity-20" />
                                            </div>
                                            <p className="text-xs text-slate-500 font-bold uppercase tracking-widest">실시간 데이터를 가져와주세요</p>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>

                        {/* Category Explorer */}
                        <div className="space-y-10 pb-20">
                            {CATEGORIZED_LIST.map((cat) => (
                                <div key={cat.category} className="space-y-4">
                                    <h3 className="text-[10px] font-black text-slate-500 uppercase tracking-widest px-2 border-l-2 border-indigo-500 ml-2">{cat.category}</h3>
                                    <div className="stock-grid">
                                        {cat.items.map(item => {
                                            const active = visibleStocks.has(item.ticker);
                                            const hasData = !!stockDataMap[item.ticker];
                                            const rsItem = ranking.find(r => r.ticker === item.ticker);
                                            return (
                                                <button key={item.ticker} onClick={() => toggleVisible(item.ticker)} className={`group p-3 rounded-2xl border transition-all duration-200 text-left relative overflow-hidden ${active ? 'bg-indigo-500/10 border-indigo-500/50 ring-1 ring-indigo-500/20' : 'bg-white/5 border-white/5 opacity-40 hover:opacity-100 hover:border-white/20'}`}>
                                                    <div className="flex justify-between items-start">
                                                        <span className="text-xs font-black text-white">{item.ticker}</span>
                                                        {hasData && <div className="w-1.5 h-1.5 rounded-full bg-green-500 shadow-sm shadow-green-500/50"></div>}
                                                    </div>
                                                    <div className="text-[9px] text-slate-500 font-bold truncate mt-0.5">{item.name}</div>
                                                    {rsItem ? (
                                                        <div className={`text-[10px] font-black mt-2 ${parseFloat(rsItem.rs) >= 0 ? 'text-indigo-400' : 'text-rose-400'}`}>
                                                            {parseFloat(rsItem.rs) > 0 ? '+' : ''}{rsItem.rs}%
                                                        </div>
                                                    ) : (
                                                        <div className="text-[8px] text-slate-700 font-bold mt-2 uppercase tracking-tighter">
                                                            {active && !hasData ? 'Syncing...' : 'No Data'}
                                                        </div>
                                                    )}
                                                </button>
                                            );
                                        })}
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
