<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>미국 섹터 vs QQQ 상대강도 분석기</title>
    
    <!-- 스타일 (Tailwind CSS) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 리액트 및 라이브러리 (버전 고정 및 순서 최적화 - 중요!) -->
    <!-- 1. React Core (18.2.0) -->
    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    
    <!-- 2. Prop Types (Recharts가 의존함) -->
    <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>
    
    <!-- 3. Recharts (안정적인 버전 2.12.7 고정) -->
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>
    
    <!-- 4. Babel (JSX 변환) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 5. Lucide 아이콘 -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body { background-color: #0f172a; color: #f1f5f9; font-family: sans-serif; }
        /* 커스텀 스크롤바 */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // React 및 Recharts 객체 비구조화 할당
        const { useState, useEffect, useMemo } = React;
        const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, ReferenceLine } = Recharts;

        // 아이콘 컴포넌트 (Lucide 아이콘 래퍼)
        const Icon = ({ name, size = 18, className = "" }) => {
            const icons = {
                TrendingUp: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></svg>,
                Activity: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline></svg>,
                Filter: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon></svg>,
                RefreshCw: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M8 21H3v-5"></path></svg>,
                Info: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>,
                Settings: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg>,
                Database: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><ellipse cx="12" cy="5" rx="9" ry="3"></ellipse><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path></svg>,
                AlertCircle: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>,
                CheckCircle2: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"></path><path d="m9 12 2 2 4-4"></path></svg>,
            };
            return icons[name] || null;
        };

        // 섹터 데이터 정의
        const SECTORS = [
            { ticker: 'XLK', name: '기술 (Tech)', color: '#3b82f6', beta: 1.2 },
            { ticker: 'XLV', name: '헬스케어 (Health)', color: '#ec4899', beta: 0.8 },
            { ticker: 'XLF', name: '금융 (Financial)', color: '#22c55e', beta: 0.9 },
            { ticker: 'XLY', name: '임의소비재 (Discretionary)', color: '#f97316', beta: 1.1 },
            { ticker: 'XLP', name: '필수소비재 (Staples)', color: '#eab308', beta: 0.6 },
            { ticker: 'XLE', name: '에너지 (Energy)', color: '#ef4444', beta: 0.7 },
            { ticker: 'XLI', name: '산업재 (Industrial)', color: '#a855f7', beta: 1.0 },
            { ticker: 'XLB', name: '소재 (Materials)', color: '#14b8a6', beta: 0.9 },
            { ticker: 'XLRE', name: '부동산 (Real Estate)', color: '#6366f1', beta: 0.8 },
            { ticker: 'XLC', name: '통신 (Comm)', color: '#f43f5e', beta: 1.1 },
            { ticker: 'XLU', name: '유틸리티 (Utilities)', color: '#84cc16', beta: 0.5 },
        ];

        // --- 1. 시뮬레이션 데이터 생성기 ---
        const generateMockData = (days) => {
            const data = [];
            let qqqPrice = 400;
            const sectorPrices = {};
            SECTORS.forEach(s => sectorPrices[s.ticker] = 100);
            const today = new Date();

            for (let i = days; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];

                const marketMove = (Math.random() - 0.48) * 2;
                qqqPrice = qqqPrice * (1 + marketMove / 100);

                const dataPoint = { date: dateStr, QQQ: qqqPrice };

                SECTORS.forEach(sector => {
                    const noise = (Math.random() - 0.5) * 1.5; 
                    const change = (marketMove * sector.beta) + noise;
                    sectorPrices[sector.ticker] = sectorPrices[sector.ticker] * (1 + change / 100);
                    dataPoint[sector.ticker] = sectorPrices[sector.ticker];
                });

                data.push(dataPoint);
            }
            return data;
        };

        // --- 2. API 호출 로직 ---
        const fetchAlphaVantage = async (symbol, apiKey) => {
            const url = `https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=${symbol}&outputsize=full&apikey=${apiKey}`;
            const response = await fetch(url);
            const data = await response.json();
            
            if (data['Note']) throw new Error("API Call Limit");
            if (data['Information']) throw new Error("API Daily Limit");
            if (data['Error Message']) throw new Error("Invalid Key");
            
            const timeSeries = data['Time Series (Daily)'];
            if (!timeSeries) throw new Error("No Data");

            const cleanData = {};
            Object.keys(timeSeries).forEach(date => {
                cleanData[date] = parseFloat(timeSeries[date]['4. close']);
            });
            return cleanData;
        };

        const fetchPolygon = async (symbol, apiKey) => {
            const daysToFetch = 400; 
            const today = new Date();
            const startDate = new Date();
            startDate.setDate(today.getDate() - daysToFetch);
            
            const to = today.toISOString().split('T')[0];
            const from = startDate.toISOString().split('T')[0];
            
            const url = `https://api.polygon.io/v2/aggs/ticker/${symbol}/range/1/day/${from}/${to}?adjusted=true&sort=asc&limit=5000&apiKey=${apiKey}`;
            
            const response = await fetch(url);
            
            if (response.status === 429) throw new Error("API Call Limit"); 
            if (response.status === 401 || response.status === 403) throw new Error("Invalid Key");
            
            const data = await response.json();
            if (!data.results || data.results.length === 0) throw new Error("No Data");

            const cleanData = {};
            data.results.forEach(item => {
                const dateStr = new Date(item.t).toISOString().split('T')[0];
                cleanData[dateStr] = item.c; 
            });
            return cleanData;
        };

        // --- 메인 컴포넌트 ---
        const App = () => {
            const [timeframe, setTimeframe] = useState(90);
            const [rawData, setRawData] = useState([]);
            const [fullTimeSeries, setFullTimeSeries] = useState(null); 
            const [visibleSectors, setVisibleSectors] = useState(new Set(['XLK', 'XLV', 'XLF']));
            const [isGenerating, setIsGenerating] = useState(false);
            
            const [useRealData, setUseRealData] = useState(false);
            const [apiProvider, setApiProvider] = useState('ALPHA'); 
            const [apiKey, setApiKey] = useState(''); 
            const [showSettings, setShowSettings] = useState(false);
            const [loadingProgress, setLoadingProgress] = useState('');
            const [apiError, setApiError] = useState('');

            // 로컬 스토리지에서 API 키 불러오기
            useEffect(() => {
                const savedKey = localStorage.getItem('stockAppApiKey');
                const savedProvider = localStorage.getItem('stockAppProvider');
                if (savedKey) setApiKey(savedKey);
                if (savedProvider) setApiProvider(savedProvider);
            }, []);

            // API 키 저장 함수
            const saveSettings = (key, provider) => {
                setApiKey(key);
                setApiProvider(provider);
                localStorage.setItem('stockAppApiKey', key);
                localStorage.setItem('stockAppProvider', provider);
            };

            useEffect(() => {
                if (useRealData) {
                    if (fullTimeSeries) processFetchedData(fullTimeSeries);
                } else {
                    handleMockRefresh();
                }
            }, [timeframe, useRealData]);

            const handleMockRefresh = () => {
                setIsGenerating(true);
                setLoadingProgress('시뮬레이션 데이터 생성 중...');
                setTimeout(() => {
                    const data = generateMockData(timeframe);
                    setRawData(data);
                    setIsGenerating(false);
                    setLoadingProgress('');
                }, 500);
            };

            const handleRealDataFetch = async () => {
                if (!apiKey) {
                    setApiError('API 키를 입력해주세요.');
                    return;
                }
                
                // 설정 저장
                saveSettings(apiKey, apiProvider);

                setIsGenerating(true);
                setApiError('');
                setRawData([]);
                setFullTimeSeries(null);

                const allSymbols = ['QQQ', ...SECTORS.map(s => s.ticker)];
                const fetchedResults = {};
                const total = allSymbols.length;
                let completed = 0;

                const CALLS_PER_MINUTE = 5; 
                const COOLDOWN_SECONDS = 65; 

                try {
                    for (let i = 0; i < allSymbols.length; i++) {
                        const symbol = allSymbols[i];
                        
                        if (i > 0 && i % CALLS_PER_MINUTE === 0) {
                            for (let sec = COOLDOWN_SECONDS; sec > 0; sec--) {
                                setLoadingProgress(`API(${apiProvider}) 무료 제한 대기 중... ${sec}초 후 재개 (${completed}/${total} 완료)`);
                                await new Promise(r => setTimeout(r, 1000));
                            }
                        }

                        setLoadingProgress(`${symbol} 데이터 가져오는 중... (${completed + 1}/${total})`);
                        
                        try {
                            let data;
                            if (apiProvider === 'ALPHA') data = await fetchAlphaVantage(symbol, apiKey);
                            else data = await fetchPolygon(symbol, apiKey);
                            
                            fetchedResults[symbol] = data;
                            completed++;
                        } catch (err) {
                            console.error(`${symbol} fetch error:`, err);
                            if (err.message === "API Call Limit") {
                                setApiError("API 호출 빈도 제한 감지. 1분 대기 후 자동으로 재시도합니다.");
                                await new Promise(r => setTimeout(r, 65000));
                                i--; 
                            } else if (err.message === "API Daily Limit" || err.message === "Invalid Key") {
                                throw err;
                            } else {
                                if (symbol === 'QQQ') throw new Error(`기준 데이터(QQQ) 로드 실패: ${err.message}`);
                                console.warn(`${symbol} 로드 실패, 건너뜁니다.`);
                            }
                        }
                    }
                    setFullTimeSeries(fetchedResults);
                    processFetchedData(fetchedResults);

                } catch (e) {
                    setApiError('데이터 가져오기 실패: ' + e.message);
                } finally {
                    setIsGenerating(false);
                    setLoadingProgress('');
                }
            };

            const processFetchedData = (results) => {
                if (!results || !results['QQQ']) return;

                const allDates = new Set();
                Object.values(results).forEach(symbolData => {
                    Object.keys(symbolData).forEach(date => allDates.add(date));
                });

                const sortedDates = Array.from(allDates).sort();
                const recentDates = sortedDates.slice(-timeframe);

                const formattedData = recentDates.map(date => {
                    const point = { date };
                    if (!results['QQQ'][date]) return null;

                    point['QQQ'] = results['QQQ'][date];
                    SECTORS.forEach(s => {
                        if (results[s.ticker] && results[s.ticker][date]) {
                            point[s.ticker] = results[s.ticker][date];
                        }
                    });
                    return point;
                }).filter(p => p !== null);

                setRawData(formattedData);
            };

            const toggleSector = (ticker) => {
                const newSet = new Set(visibleSectors);
                if (newSet.has(ticker)) newSet.delete(ticker);
                else newSet.add(ticker);
                setVisibleSectors(newSet);
            };

            const chartData = useMemo(() => {
                if (rawData.length === 0) return [];
                const startPrices = rawData[0];
                
                return rawData.map(day => {
                    const point = { date: day.date };
                    if (!startPrices.QQQ) return point;
                    const qqqReturn = (day.QQQ / startPrices.QQQ);

                    SECTORS.forEach(sector => {
                        if (visibleSectors.has(sector.ticker)) {
                            if (!day[sector.ticker] || !startPrices[sector.ticker]) {
                                point[sector.ticker] = null;
                            } else {
                                const sectorReturn = (day[sector.ticker] / startPrices[sector.ticker]);
                                const rs = ((sectorReturn / qqqReturn) - 1) * 100; 
                                point[sector.ticker] = parseFloat(rs.toFixed(2));
                            }
                        }
                    });
                    return point;
                });
            }, [rawData, visibleSectors]);

            const TimeBtn = ({ label, days }) => (
                <button
                    onClick={() => setTimeframe(days)}
                    className={`px-3 py-1 text-sm rounded-md transition-colors ${
                        timeframe === days 
                        ? 'bg-blue-600 text-white font-bold' 
                        : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                    }`}
                >
                    {label}
                </button>
            );

            return (
                <div className="min-h-screen p-4 md:p-8 font-sans">
                    <div className="max-w-7xl mx-auto space-y-6">
                        {/* 헤더 */}
                        <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 border-b border-slate-700 pb-6">
                            <div>
                                <h1 className="text-2xl md:text-3xl font-bold flex items-center gap-2 text-white">
                                    <Icon name="TrendingUp" className="text-blue-400" />
                                    미국 섹터 vs QQQ 상대강도
                                </h1>
                                <p className="text-slate-400 mt-1 text-sm md:text-base flex items-center gap-2">
                                    {useRealData 
                                        ? <><Icon name="CheckCircle2" className="text-green-500" /> {apiProvider === 'ALPHA' ? 'Alpha Vantage' : 'Polygon.io'} 실제 데이터 모드</> 
                                        : '시뮬레이션 데이터 모드'
                                    }
                                </p>
                            </div>
                            
                            <div className="flex items-center gap-2">
                                <button onClick={() => setShowSettings(!showSettings)} className={`flex items-center gap-2 px-4 py-2 rounded-lg text-sm transition-colors border ${showSettings ? 'bg-blue-600 border-blue-500 text-white' : 'bg-slate-800 border-slate-700 hover:bg-slate-700'}`}>
                                    <Icon name="Settings" /> API 설정
                                </button>
                                <button onClick={useRealData ? handleRealDataFetch : handleMockRefresh} disabled={isGenerating} className="flex items-center gap-2 px-4 py-2 bg-slate-800 hover:bg-slate-700 rounded-lg text-sm transition-colors border border-slate-700 disabled:opacity-50">
                                    <Icon name="RefreshCw" className={isGenerating ? "animate-spin" : ""} /> {isGenerating ? '로딩 중...' : '데이터 갱신'}
                                </button>
                            </div>
                        </div>

                        {/* API 설정 패널 */}
                        {showSettings && (
                            <div className="bg-slate-800 p-4 rounded-xl border border-slate-600 animate-in fade-in slide-in-from-top-2">
                                <div className="flex flex-col gap-4">
                                    <div className="flex flex-col md:flex-row md:items-center justify-between gap-2">
                                        <h3 className="font-bold flex items-center gap-2 min-w-[120px] text-white">
                                            <Icon name="Database" className="text-blue-400" /> 데이터 소스
                                        </h3>
                                        <div className="flex bg-slate-900 p-1 rounded-lg w-full md:w-auto">
                                            <button onClick={() => setUseRealData(false)} className={`flex-1 md:flex-none px-4 py-2 rounded-md text-sm ${!useRealData ? 'bg-slate-700 text-white shadow' : 'text-slate-400 hover:text-slate-200'}`}>시뮬레이션</button>
                                            <button onClick={() => setUseRealData(true)} className={`flex-1 md:flex-none px-4 py-2 rounded-md text-sm ${useRealData ? 'bg-blue-600 text-white shadow' : 'text-slate-400 hover:text-slate-200'}`}>실제 API 사용</button>
                                        </div>
                                    </div>
                                    
                                    {useRealData && (
                                        <div className="space-y-4 pt-2 border-t border-slate-700">
                                            <div className="flex flex-col gap-2">
                                                <label className="text-sm text-slate-300 font-semibold">API 제공업체 선택</label>
                                                <div className="grid grid-cols-2 gap-3">
                                                    <button onClick={() => { saveSettings('', 'ALPHA'); setApiError(''); }} className={`p-3 rounded-lg border text-left transition-all ${apiProvider === 'ALPHA' ? 'bg-blue-900/40 border-blue-500 ring-1 ring-blue-500' : 'bg-slate-900 border-slate-700 hover:border-slate-500'}`}>
                                                        <div className="font-bold text-sm text-white mb-1">Alpha Vantage</div>
                                                        <div className="text-xs text-slate-400">전통적인 무료 API</div>
                                                    </button>
                                                    <button onClick={() => { saveSettings('', 'POLYGON'); setApiError(''); }} className={`p-3 rounded-lg border text-left transition-all ${apiProvider === 'POLYGON' ? 'bg-blue-900/40 border-blue-500 ring-1 ring-blue-500' : 'bg-slate-900 border-slate-700 hover:border-slate-500'}`}>
                                                        <div className="font-bold text-sm text-white mb-1">Polygon.io</div>
                                                        <div className="text-xs text-slate-400">안정적임</div>
                                                    </button>
                                                </div>
                                            </div>

                                            <div className="space-y-2">
                                                <label className="text-sm text-slate-300 flex justify-between">
                                                    <span>API Key</span>
                                                    <a href={apiProvider === 'ALPHA' ? "https://www.alphavantage.co/support/#api-key" : "https://polygon.io/dashboard/signup"} target="_blank" rel="noreferrer" className="text-blue-400 hover:underline text-xs">(키 무료 발급받기)</a>
                                                </label>
                                                <input type="text" value={apiKey} onChange={(e) => saveSettings(e.target.value, apiProvider)} placeholder={`${apiProvider} API Key 입력`} className="w-full bg-slate-900 border border-slate-700 rounded-md px-3 py-2 text-sm focus:outline-none focus:border-blue-500 text-slate-100" />
                                            </div>
                                            
                                            <div className="flex items-start gap-2 text-xs text-orange-400 bg-orange-900/20 p-3 rounded-lg">
                                                <Icon name="AlertCircle" size={16} />
                                                <div>
                                                    <p className="font-bold mb-1">무료 API 제한 알림</p>
                                                    <p>무료 키는 <strong>1분당 5회 호출 제한</strong>이 있어, 데이터 로딩 시 <strong>약 2분 정도 대기 시간</strong>이 발생합니다.</p>
                                                </div>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {isGenerating && useRealData && (
                            <div className="bg-blue-900/30 border border-blue-800 text-blue-200 px-4 py-3 rounded-xl flex items-center gap-3 animate-pulse">
                                <Icon name="RefreshCw" className="animate-spin" />
                                <span className="text-sm md:text-base font-medium">{loadingProgress}</span>
                            </div>
                        )}

                        {apiError && (
                            <div className="bg-red-900/30 border border-red-800 text-red-200 px-4 py-3 rounded-xl flex items-center gap-3">
                                <Icon name="AlertCircle" />
                                <span className="text-sm md:text-base">{apiError}</span>
                            </div>
                        )}

                        <div className="bg-slate-800/50 rounded-xl p-4 border border-slate-700 backdrop-blur-sm">
                            <div className="flex flex-col md:flex-row justify-between gap-4">
                                <div className="flex items-center gap-2">
                                    <Icon name="Activity" className="text-slate-400" />
                                    <span className="text-sm font-semibold text-slate-300 mr-2">기간:</span>
                                    <div className="flex gap-1 bg-slate-800 p-1 rounded-lg">
                                        <TimeBtn label="1개월" days={30} />
                                        <TimeBtn label="3개월" days={90} />
                                        <TimeBtn label="6개월" days={180} />
                                        <TimeBtn label="1년" days={365} />
                                    </div>
                                </div>
                                <div className="flex items-center gap-2 text-xs text-slate-400 bg-slate-800 px-3 py-2 rounded-lg">
                                    <Icon name="Info" size={14} />
                                    <span>Y축 &gt; 0 : QQQ보다 강함 | Y축 &lt; 0 : QQQ보다 약함</span>
                                </div>
                            </div>
                        </div>

                        <div className="bg-slate-800 rounded-xl p-4 md:p-6 border border-slate-700 shadow-xl h-[500px]">
                            <ResponsiveContainer width="100%" height="100%">
                                <LineChart data={chartData} margin={{ top: 10, right: 10, left: -20, bottom: 0 }}>
                                    <CartesianGrid strokeDasharray="3 3" stroke="#334155" vertical={false} />
                                    <XAxis dataKey="date" stroke="#94a3b8" tick={{fill: '#94a3b8', fontSize: 12}} tickFormatter={(str) => str ? str.substring(5) : ''} minTickGap={30} />
                                    <YAxis stroke="#94a3b8" tick={{fill: '#94a3b8', fontSize: 12}} unit="%" domain={['auto', 'auto']} />
                                    <Tooltip contentStyle={{ backgroundColor: '#1e293b', borderColor: '#334155', color: '#f8fafc' }} itemStyle={{ fontSize: '12px' }} labelStyle={{ marginBottom: '8px', fontWeight: 'bold' }} formatter={(value) => [`${value}%`, '상대강도']} />
                                    <Legend wrapperStyle={{ paddingTop: '20px' }} />
                                    <ReferenceLine y={0} stroke="#ef4444" strokeDasharray="3 3" strokeWidth={1} label={{ position: 'right', value: 'QQQ 기준', fill: '#ef4444', fontSize: 10 }} />
                                    {SECTORS.map(sector => (
                                        visibleSectors.has(sector.ticker) && (
                                            <Line key={sector.ticker} type="monotone" dataKey={sector.ticker} name={sector.name} stroke={sector.color} strokeWidth={2} dot={false} activeDot={{ r: 6 }} connectNulls />
                                        )
                                    ))}
                                </LineChart>
                            </ResponsiveContainer>
                        </div>

                        <div className="space-y-3">
                            <div className="flex items-center gap-2 text-slate-300 mb-2">
                                <Icon name="Filter" />
                                <h3 className="font-semibold text-sm">보고 싶은 섹터 선택</h3>
                            </div>
                            <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3">
                                {SECTORS.map(sector => {
                                    const isActive = visibleSectors.has(sector.ticker);
                                    return (
                                        <button key={sector.ticker} onClick={() => toggleSector(sector.ticker)} className={`flex items-center justify-between px-3 py-2 rounded-lg text-sm border transition-all duration-200 ${isActive ? 'bg-slate-700/80 border-slate-500 text-white shadow-md' : 'bg-slate-900 border-slate-800 text-slate-500 hover:border-slate-700'}`} style={isActive ? { borderLeftColor: sector.color, borderLeftWidth: '4px' } : {}}>
                                            <span className="font-medium">{sector.ticker}</span>
                                            <span className="text-xs opacity-80">{sector.name.split(' ')[0]}</span>
                                        </button>
                                    );
                                })}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>